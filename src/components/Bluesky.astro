---
import agent from "../utils/bluesky";
import { CacheHeaders, ONE_HOUR } from "cdn-cache-control";

import {BlueskyPost} from '@astro-community/astro-embed-bluesky'

const cacheHeaders = new CacheHeaders()
cacheHeaders.forEach((value, key) => Astro.response.headers.set(key, value))


export const prerender = false;
console.log(import.meta.env.CURRENT_URL, process.env.DEPLOY_URL, process.env.URL, process.env.DEPLOY_URL, process.env.SITE_NAME, import.meta.env.SITE_NAME)
const response = await fetch(`${process.env.CURRENT_URL}/api/bluesky/latestPost`)
console.log('my deploy url', import.meta.env.DEPLOY_URL)
if (!response.ok) {
    throw new Error(`Response status: ${response.status}`);
}

const post = await response.json();
---

<BlueskyPost id={post.uri} />
