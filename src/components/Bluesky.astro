---
import agent from "../utils/bluesky";
import { CacheHeaders, ONE_HOUR } from "cdn-cache-control";
import etag from "etag";

import {BlueskyPost} from '@astro-community/astro-embed-bluesky'


export const prerender = false;

const response = await fetch(`${process.env.CURRENT_URL}/api/bluesky/latestPost`)


if (!response.ok) {
    throw new Error(`Response status: ${response.status}`);
}

const post = await response.json();
const cacheHeaders = new CacheHeaders({
    "etag": etag(JSON.stringify(post)),

}).ttl(300)
cacheHeaders.forEach((value, key) => Astro.response.headers.set(key, value))
console.log(Astro.response.headers)


---

<BlueskyPost id={post.uri} />
